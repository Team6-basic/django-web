{% extends 'base.html' %}
{% load hopecharm_filter %}
{% block content %}
  <nav class="navbar">
    <div class="navwrap">
      <div class="nav_logo_wrap" href="{% url 'hopecharm:index' %}">
        <div class="nav_logo_image"></div>
        <span class="nav_logo_text">í¬ë§ì°¸</span>
      </div>

      <div class="nav_login">
        <ul>
          <li class="nav-item ">
            {% if user.is_authenticated %}
            <a class="nav-link" href="{% url 'logout' %}">{{ user.username }} (ë¡œê·¸ì•„ì›ƒ)</a>
            {% else %}
            <a class="nav-link" href="{% url 'login'  %}">ë¡œê·¸ì¸</a>
            {% endif %}
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- main -->
    <div class="vis_wrap">
      <div class="user_text">
        {% if user.is_authenticated %}
        <span href="{% url 'logout' %}">êµ­ë‚´ í˜ì˜¤í‘œí˜„ ì§€í‘œ í˜„í™©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</span>
        {% else %}
        <span href="{% url 'login'  %}">ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.</span>
        {% endif %}
      </div>
      <!-- ë°ì´í„° ì‹œê°í™” -->
      <!-- ìœ„ ë°ì´í„°í–‰-->
      <div class="data_vis" id="vis1">  
        <div class="graph_wrap">
          <div id='mc'><canvas id="myChart"></canvas></div>         
          <div id='mc2'><canvas id="myChart2"></canvas></div>
        </div>
      </div>
      <!-- vis1 chart.js -->
      <script>
        const datas = {{monthly_df}};
        $(function () {
            var ctx = document.getElementById("myChart").getContext('2d');
            var data = {
              label:'ì›”ê°„ í˜ì˜¤í‘œí˜„ ìœ í˜•ë³„ í†µê³„',
                datasets: [{
                    data: [datas[0][2], datas[1][3], datas[2][4], datas[3][5], datas[4][6], datas[5][7],
                    datas[6][8], datas[7][9], datas[8][10]],
                    backgroundColor: ['#3c8dbc','#f39c12','#dfaebd','#434343','#33115c',
                    '#226d1f','#069583','#95c798','#f56954'],
                }],
                labels: ["ì—¬ì„±/ê°€ì¡±", "ë‚¨ì„±", "ì„±ì†Œìˆ˜ì", "ì¸ì¢…/êµ­ì ", "ì—°ë ¹", "ì§€ì—­", "ì¢…êµ", "ê¸°íƒ€í˜ì˜¤", "ì•…í”Œ/ìš•ì„¤"]
            };
            var mypieChart = new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                  layout:{padding:20},
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins:{
                      title:{display:true,text:'ì›”ê°„ í˜ì˜¤í‘œí˜„ ìœ í˜•ë³„ í†µê³„'},
                      legend:{
                        labels:{
                          boxWidth:40,
                          boxHeight:5,
                        }
                      }
                    },

                }
            });

            var ctx_2 = document.getElementById("myChart2");
            var data_2 = {
              datasets: [{
                label:'í˜ì˜¤í‘œí˜„ ìƒí™©ë³„ í†µê³„',
                data: [{x:46.7, y:'ì˜¤í”„ë¼ì¸(ì •ê·œìˆ˜ì—…, ë°©ê³¼í›„ ìˆ˜ì—… ë“±)'},
                {x:35.5, y:'ì˜¨ë¼ì¸(SNS, ê²Œì„, ë‹¨í†¡ë°© ë“±)'},
                {x:17.8, y:'ê¸°íƒ€(ì¹œêµ¬ë“¤ê³¼ ë§Œë‚¨, ì‰¬ëŠ” ì‹œê°„ ë“±)'}],
                backgroundColor: ['#3c8dbc','#f56954','#f39c12'],
              }]
            };
            var mybarChart_2 = new Chart(ctx_2, {
                type: 'bar',
                data: data_2,
                options: {
                  layout:{padding:20},
                  indexAxis:'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins:{
                      title:{display:true,text:'í˜ì˜¤í‘œí˜„ ì‚¬ìš© ìƒí™©ë³„ í†µê³„'},
                      legend:{
                        labels:{
                          display:false
                        }
                      }
                    },
                    scales:{
                      x:{
                        ticks:{
                          callback:function(value,index,ticks){
                            return value + '%';
                          }
                        }
                      },
                      y:{
                        ticks:{
                          callback:function(value,index,ticks){
                            const bar_key=['ì˜¤í”„ë¼ì¸','ì˜¨ë¼ì¸','ê¸°íƒ€']
                            return bar_key[index];
                          }
                        }
                      }
                    }
                }
            });
        });

    </script>

      <!-- ë°‘ì— ë°ì´í„°í–‰-->
    <div class="data_vis" id="vis2">
      
      <!-- ë‰´ìŠ¤ -->
      <div id="news_wrap">
        <div class="outer" >
          <div class="inner-list">
            <div class="inner" id="news1">
              <div class="area" href="#" onClick="window.open('https://webzine-serii.re.kr/%ED%98%90%EC%98%A4-%ED%91%9C%ED%98%84-%EC%99%9C-%EB%AC%B8%EC%A0%9C%EC%9D%B4%EA%B3%A0-%EC%96%B4%EB%96%BB%EA%B2%8C-%EA%B7%B9%EB%B3%B5%ED%95%A0%EA%B9%8C/', '_blank')">
                <h4>ì„œìš¸êµìœ¡::ê¶Œë‘ì¹¼ëŸ¼</h4>
                <hr class="inner_line">
                <h4>í˜ì˜¤ í‘œí˜„, ì™œ ë¬¸ì œì´ê³  ì–´ë–»ê²Œ ê·¹ë³µí•  ê²ƒì¸ê°€</h4>
              </div>
              </div>
            <div class="inner" id="news2">
              <div class="area" href="#" onClick="window.open('https://www.dbpia.co.kr/journal/articleDetail?nodeId=NODE10535648', '_blank')">
                <h4>í•œêµ­ì²­ì†Œë…„ì •ì±…ì—°êµ¬ì›</h4>
                <hr class="inner_line">
                <h4>ì²­ì†Œë…„ í˜ì˜¤í‘œí˜„ì˜ ëŒ€ì‘ ë°©ì•ˆ</h4>
              </div>
            </div>
            <div class="inner" id="news3">
              <div class="area" href="#" onClick="window.open('https://www.dbpia.co.kr/journal/articleDetail?nodeId=NODE10894205', '_blank')">
                <h4>í•œêµ­ì—¬ì„±ì»¤ë®¤ë‹ˆì¼€ì´ì…˜í•™íšŒ</h4>
                <hr class="inner_line">
                <h4>í•™êµê³µê°„ì—ì„œì˜ í˜ì˜¤í‘œí˜„</h4>
              </div>
            </div>
          </div>
        </div>
        <div class="button-list">
          <button class="button-left">ì´ì „</button>
          <button class="button-right">ë‹¤ìŒ</button>
        </div>
      </div>
      <!-- ìŠ¬ë¼ì´ë“œ ë‰´ìŠ¤ ë°°ë„ˆ-->
      <script>
      {% comment %} divì‚¬ì´ì¦ˆ ë™ì ìœ¼ë¡œ êµ¬í•˜ê¸° {% endcomment %}
        const outer = document.querySelector('.outer');
        const innerList = document.querySelector('.inner-list');
        const inners = document.querySelectorAll('.inner');
        let currentIndex = 0; // í˜„ì¬ ìŠ¬ë¼ì´ë“œ í™”ë©´ ì¸ë±ìŠ¤

        inners.forEach((inner) => {
          inner.style.width = `${outer.clientWidth}px`; // innerì˜ widthë¥¼ ëª¨ë‘ outerì˜ widthë¡œ ë§Œë“¤ê¸°
        })

        innerList.style.width = `${outer.clientWidth * inners.length}px`; // innerListì˜ widthë¥¼ innerì˜ width * innerì˜ ê°œìˆ˜ë¡œ ë§Œë“¤ê¸°

        /*
          ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë“±ë¡í•˜ê¸°
        */
        const buttonLeft = document.querySelector('.button-left');
        const buttonRight = document.querySelector('.button-right');

        buttonLeft.addEventListener('click', () => {
          currentIndex--;
          currentIndex = currentIndex < 0 ? 0 : currentIndex; // indexê°’ì´ 0ë³´ë‹¤ ì‘ì•„ì§ˆ ê²½ìš° 0ìœ¼ë¡œ ë³€ê²½
          innerList.style.marginLeft = `-${outer.clientWidth * currentIndex}px`; // indexë§Œí¼ marginì„ ì£¼ì–´ ì˜†ìœ¼ë¡œ ë°€ê¸°
        });

        buttonRight.addEventListener('click', () => {
          currentIndex++;
          currentIndex = currentIndex >= inners.length ? inners.length - 1 : currentIndex; // indexê°’ì´ innerì˜ ì´ ê°œìˆ˜ë³´ë‹¤ ë§ì•„ì§ˆ ê²½ìš° ë§ˆì§€ë§‰ ì¸ë±ìŠ¤ê°’ìœ¼ë¡œ ë³€ê²½
          innerList.style.marginLeft = `-${outer.clientWidth * currentIndex}px`; // indexë§Œí¼ marginì„ ì£¼ì–´ ì˜†ìœ¼ë¡œ ë°€ê¸°
        });
      </script>

      <!--ìƒê´€ê³„ìˆ˜-->  
      <div id="stats_wrap">
        <div class='relation' > 
        <div id="statitle">
          <span>í˜ì˜¤í‘œí˜„ ìœ í˜• ê°„ ìƒê´€ê³„ìˆ˜ Top5</span>
        </div>
        <table>
          <tr class='rel'>
            <td>ì—°ë ¹ / ì§€ì—­</td>
            <td>0.857</td>
          </tr>
          <tr class='rel'>
            <td>ì—¬ì„±,ê°€ì¡± / ê¸°íƒ€í˜ì˜¤</td>
            <td>0.78</td>
          </tr>
          <tr class='rel'>
            <td>ì§€ì—­ / ë‚¨ì„±</td>
            <td>0.774</td>
          </tr>
          <tr class='rel'> 
            <td>ì¢…êµ / ì§€ì—­</td>
            <td>0.728</td>
          </tr>
          <tr class='rel'>
            <td>ë‹¨ìˆœ ì•…í”Œ / ì¸ì¢…/êµ­ì </td>
            <td>0.718</td>
          </tr>
        </table>
      </div>
      </div>
    </div>

  </div>

  <!-- ì¼ë³„ ë…¹ìŒë³¸ -->
  <div class="day_wrap">
    <!-- ì œëª© -->
    <div class="title">
      <span id="list">ğŸ—“ï¸ ë‚ ì§œë³„ë¡œ ì–¸ì–´í™˜ê²½ í™•ì¸í•˜ê¸°</span>
    </div>

    <!-- ì¼ë³„ ë°ì´í„° -->
    <div class="content">
      <table>
        <tbody>
        {% if board_list %}
        {% for board in board_list %}
          <tr class="card">
            <th>
            <div class="cal">
              <div id="year">{{ board.rec_date | date:'Y' }}</div>
              <div id="date">{{ board.rec_date | date:'m-d' }}</div>
            </div>
            </th>
            <td>
            </td>
            <td><!-- ì¼ìë³„ Detail íŒì—…ë²„íŠ¼ -->
            <a href="{% url 'hopecharm:detail' board.id %}">ì¼ë³„ í†µê³„ í™•ì¸</a>
            </td>
            {% for indc in indicator %}
            {% if indc|reportkey:"id" == board.id  %}
            <td><a class="toxicity"> {{ indc|reportkey:"toxic" }}</a>
              <img class="tox_image" alt="indicate" src="../static/images/green.png"/>
            </td>
            {% endif %}{% endfor %}
            <td>{{ board_list.paginator.count|sub:board_list.start_index|sub:forloop.counter0|add:1 }}</td>
          </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td>ìˆ˜ì§‘ëœ ì–¸ì–´í™˜ê²½ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
        {% endif %}
        </tbody>
      </table>

      <div>
          <span>
            <!-- í˜ì´ì§•ì²˜ë¦¬ ì‹œì‘ -->
          <ul class ="pagination">
            <!-- ì´ì „í˜ì´ì§€ -->
            {% if board_list.has_previous %}
            <li class="page-item">
                <a class="page-link" data-page="{{ board_list.previous_page_number }}" href="#">ì´ì „</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" tabindex="-1" aria-disabled="true" href="#">ì´ì „</a>
            </li>
            {% endif %}
            <!-- í˜ì´ì§€ë¦¬ìŠ¤íŠ¸ -->
            {% for page_number in board_list.paginator.page_range %}
            {% if page_number >= board_list.number|add:-6 and page_number <= board_list.number|add:6 %}
                {% if page_number == board_list.number %}
                <li class="page-item active" aria-current="page">
                    <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                </li>
                {% else %}
                <li class="page-item">
                    <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                </li>
                {% endif %}
            {% endif %}
            {% endfor %}
            <!-- ë‹¤ìŒí˜ì´ì§€ -->
            {% if board_list.has_next %}
            <li class="page-item">
                <a class="page-link" data-page="{{ board_list.next_page_number }}" href="#">ë‹¤ìŒ</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" tabindex="-1" aria-disabled="true" href="#">ë‹¤ìŒ</a>
            </li>
            {% endif %}
        </ul></span>
        </div>
        <!-- í˜ì´ì§•ì²˜ë¦¬ ë -->
    </div> <!-- ì¼ë³„ì²˜ë¦¬ ë -->

  </div> <!-- ì»¨í…Œì´ë„ˆ ë --> 
<!-- ê³„ì •ë³„ ì—°ë™ í—ˆìš© -->
<script src="https://code.jquery.com/jquery-3.4.1.js">  
  $.ajaxSetup({
    headers: { "X-CSRFToken": '{{csrf_token}}' }
  })
</script>
<script type="text/javascript">
  
  var indicator = document.getElementsByClassName("toxicity");
  var toxic_image = document.getElementsByClassName("tox_image");
  {% comment %} ì´ë¯¸ì§€ ì •ë³´ì™€ ê¸°ì¤€ ê°’ ì¶”ì¶œ ì¶”ì¶œ {% endcomment %}
  for (var i = 0; i < indicator.length; i++) {
    var ind = indicator[i];
    var img = toxic_image[i];
    if (ind.text >= 0.93) {
      img.src = "../static/images/green.png"
    } else if (ind.text >= 0.90) {
      img.src = "../static/images/orange.png"
    } else if (ind.text < 0.87) {
      img.src = "../static/images/red.png"
    }
  }
</script>

{% endblock  %}

