{% extends 'base.html' %}
{% load hopecharm_filter %}
{% block content %}
  <nav class="navbar">
    <div class="navwrap">
      <div class="nav_logo_wrap">
        <div class="nav_logo_image"></div>
        <span class="nav_logo_text">í¬ë§ì°¸</span>
      </div>

      <div class="nav_login">
        <ul>
          <li class="nav-item ">
            {% if user.is_authenticated %}
            <a class="nav-link" href="{% url 'logout' %}">{{ user.username }} (ë¡œê·¸ì•„ì›ƒ)</a>
            {% else %}
            <a class="nav-link" href="{% url 'login'  %}">ë¡œê·¸ì¸</a>
            {% endif %}
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <!-- main -->
    <div class="vis_wrap">
      <div class="user_text">
        {% if user.is_authenticated %}
        <span href="{% url 'logout' %}">êµ­ë‚´ í˜ì˜¤í‘œí˜„ ì§€í‘œ í˜„í™©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</span>
        {% else %}
        <span href="{% url 'login'  %}">ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.</span>
        {% endif %}
      </div>
      <!-- ë°ì´í„° ì‹œê°í™” -->
      <div class="data_vis" id="vis1">  
        <div class="graph_wrap">         
          <div id="schl_viol">
            <h3>í•™êµí­ë ¥ ìœ í˜• ë¹„ìœ¨</h3>
          </div>
          <div id="kor_viol">
            <h3>êµ­ë‚´ í˜ì˜¤í‘œí˜„ í˜„í•­</h3>
          </div>
        </div>
      </div>
      
      <div class="data_vis" id="vis2">

      </div>
      
      </div>

    <!-- ì¼ë³„ ë…¹ìŒë³¸ -->
    <div class="day_wrap">
      <!-- ì œëª© -->
      <div class="title">
        <span id="list">ğŸ—“ï¸ ë‚ ì§œë³„ë¡œ ì–¸ì–´í™˜ê²½ í™•ì¸í•˜ê¸°</span>
      </div>

      <!-- ì¼ë³„ ë°ì´í„° -->
      <div class="content">
        <table>
          <tbody>
          {% if board_list %}
          {% for board in board_list %}
            <tr class="card">
              <th>
              <div class="cal">
                <div id="year">{{ board.rec_date | date:'Y' }}</div>
                <div id="date">{{ board.rec_date | date:'m-d' }}</div>
              </div>
              </th>
              <td>
              </td>
              <td><!-- ì¼ìë³„ Detail íŒì—…ë²„íŠ¼ -->
              <a href="{% url 'hopecharm:detail' board.id %}">ì¼ë³„ í†µê³„ í™•ì¸</a>
              </td>
              <td></td>
              {% for indc in indicator %}
              {% if indc|reportkey:"id" == board.id  %}
              <td><a class="toxicity"> {{ indc|reportkey:"toxic" }}</a>
                <img class="tox_image" alt="indicate" src="../static/images/green.png"/>
              </td>
              {% endif %}{% endfor %}
              <td>{{ board_list.paginator.count|sub:board_list.start_index|sub:forloop.counter0|add:1 }}</td>
            </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td>ìˆ˜ì§‘ëœ ì–¸ì–´í™˜ê²½ì´ ì—†ìŠµë‹ˆë‹¤.</td>
          </tr>
          {% endif %}
          </tbody>
        </table>

        <div>
          <span>
            <!-- í˜ì´ì§•ì²˜ë¦¬ ì‹œì‘ -->
          <ul class ="pagination">
            <!-- ì´ì „í˜ì´ì§€ -->
            {% if board_list.has_previous %}
            <li class="page-item">
                <a class="page-link" data-page="{{ board_list.previous_page_number }}" href="#">ì´ì „</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" tabindex="-1" aria-disabled="true" href="#">ì´ì „</a>
            </li>
            {% endif %}
            <!-- í˜ì´ì§€ë¦¬ìŠ¤íŠ¸ -->
            {% for page_number in board_list.paginator.page_range %}
            {% if page_number >= board_list.number|add:-6 and page_number <= board_list.number|add:6 %}
                {% if page_number == board_list.number %}
                <li class="page-item active" aria-current="page">
                    <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                </li>
                {% else %}
                <li class="page-item">
                    <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                </li>
                {% endif %}
            {% endif %}
            {% endfor %}
            <!-- ë‹¤ìŒí˜ì´ì§€ -->
            {% if board_list.has_next %}
            <li class="page-item">
                <a class="page-link" data-page="{{ board_list.next_page_number }}" href="#">ë‹¤ìŒ</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" tabindex="-1" aria-disabled="true" href="#">ë‹¤ìŒ</a>
            </li>
            {% endif %}
        </ul></span>
        </div>
        <!-- í˜ì´ì§•ì²˜ë¦¬ ë -->
    </div> <!-- ì¼ë³„ì²˜ë¦¬ ë -->
  </div> <!-- ì»¨í…Œì´ë„ˆ ë --> 
<!-- ê³„ì •ë³„ ì—°ë™ í—ˆìš© -->
<script src="https://code.jquery.com/jquery-3.4.1.js">  
  $.ajaxSetup({
    headers: { "X-CSRFToken": '{{csrf_token}}' }
  })
</script>
<script type="text/javascript">
  
  var indicator = document.getElementsByClassName("toxicity");
  var toxic_image = document.getElementsByClassName("tox_image");
  {% comment %} ì´ë¯¸ì§€ ì •ë³´ì™€ ê¸°ì¤€ ê°’ ì¶”ì¶œ ì¶”ì¶œ {% endcomment %}
  for (var i = 0; i < indicator.length; i++) {
    var ind = indicator[i];
    var img = toxic_image[i];
    if (ind.text >= 0.93) {
      img.src = "../static/images/green.png"
    } else if (ind.text >= 0.90) {
      img.src = "../static/images/orange.png"
    } else if (ind.text < 0.87) {
      img.src = "../static/images/red.png"
    }
  }
</script>
{% endblock  %}

